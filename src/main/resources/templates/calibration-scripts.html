<!-- Scripts da P√°gina de Calibra√ß√£o -->
<div th:fragment="scripts">
  <script>
    let calibrationActive = false;
    let calibrationPoints = 0;

    function startCalibration() {
      const sessionId = "session_" + Date.now();

      fetch("/api/calibration/start", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: "sessionId=" + sessionId,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            calibrationActive = true;
            updateCalibrationStatus("Calibrando...");
            console.log("‚úÖ Calibra√ß√£o iniciada");
          } else {
            console.error("‚ùå Erro ao iniciar calibra√ß√£o:", data.message);
          }
        })
        .catch((error) => {
          console.error("‚ùå Erro ao iniciar calibra√ß√£o:", error);
        });
    }

    function stopCalibration() {
      fetch("/api/calibration/stop", {
        method: "POST",
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            calibrationActive = false;
            updateCalibrationStatus("Parado");
            console.log("üõë Calibra√ß√£o parada");
          } else {
            console.error("‚ùå Erro ao parar calibra√ß√£o:", data.message);
          }
        })
        .catch((error) => {
          console.error("‚ùå Erro ao parar calibra√ß√£o:", error);
        });
    }

    function autoCalibrate() {
      const sessionId = "session_" + Date.now();

      fetch("/api/calibration/auto", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: "sessionId=" + sessionId,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            updateCalibrationStatus("Calibrado");
            console.log("‚úÖ Calibra√ß√£o autom√°tica realizada");
          } else {
            console.error("‚ùå Erro na calibra√ß√£o autom√°tica:", data.message);
          }
        })
        .catch((error) => {
          console.error("‚ùå Erro na calibra√ß√£o autom√°tica:", error);
        });
    }

    function updateCalibrationStatus(status) {
      document.getElementById("calibrationStatus").textContent = status;
    }

    function updateCalibrationPoints(points) {
      document.getElementById("calibrationPoints").textContent = points + "/9";
    }

    // Event listeners para controles
    document
      .getElementById("sensitivity")
      .addEventListener("input", function () {
        document.getElementById("sensitivityValue").textContent = this.value;
      });

    document.getElementById("deadband").addEventListener("input", function () {
      document.getElementById("deadbandValue").textContent = this.value;
    });

    // Fun√ß√£o para obter status da calibra√ß√£o
    function fetchCalibrationStatus() {
      fetch("/api/calibration/current")
        .then((response) => response.json())
        .then((data) => {
          if (data.isCalibrating) {
            updateCalibrationStatus("Calibrando...");
          } else if (data.calibrated) {
            updateCalibrationStatus("Calibrado");
          } else {
            updateCalibrationStatus("N√£o calibrado");
          }

          if (data.pointCount !== undefined) {
            updateCalibrationPoints(data.pointCount);
          }
        })
        .catch((error) => {
          console.error("Erro ao obter status da calibra√ß√£o:", error);
        });
    }

    // Inicializa√ß√£o
    document.addEventListener("DOMContentLoaded", function () {
      console.log("üéØ P√°gina de calibra√ß√£o carregada");

      // Atualiza status a cada 2 segundos
      setInterval(fetchCalibrationStatus, 2000);

      // Atualiza√ß√£o inicial
      fetchCalibrationStatus();
    });
  </script>
</div>
