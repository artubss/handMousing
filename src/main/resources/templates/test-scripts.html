<!-- Scripts para a p√°gina de teste -->
<div th:fragment="scripts">
  <script>
    $(document).ready(function () {
      console.log("üìã P√°gina de teste carregada");

      // Atualiza status inicial
      updateStatus();

      // Atualiza status a cada 5 segundos
      setInterval(updateStatus, 5000);
    });

    function updateStatus() {
      $.ajax({
        url: "/api/status",
        method: "GET",
        success: function (data) {
          if (data.status === "success") {
            updateStatusBadge("cameraStatus", data.cameraInitialized);
            updateStatusBadge("handStatus", data.handDetected);
            updateStatusBadge("mouseStatus", data.mouseEnabled);
            updateStatusBadge("calibrationStatus", data.calibrated);
          }
        },
        error: function () {
          addLogMessage("‚ùå Erro ao obter status", "text-danger");
        },
      });
    }

    function updateStatusBadge(elementId, status) {
      const element = $("#" + elementId);
      if (status) {
        element
          .removeClass("bg-warning bg-danger")
          .addClass("bg-success")
          .text("OK");
      } else {
        element
          .removeClass("bg-success bg-danger")
          .addClass("bg-warning")
          .text("Pendente");
      }
    }

    function addLogMessage(message, className = "text-info") {
      const logDiv = $("#testLog");
      const timestamp = new Date().toLocaleTimeString();
      logDiv.append(
        `<div class="${className}">[${timestamp}] ${message}</div>`
      );
      logDiv.scrollTop(logDiv[0].scrollHeight);
    }

    function testCamera() {
      addLogMessage("üìπ Testando c√¢mera...", "text-info");

      $.ajax({
        url: "/api/status",
        method: "GET",
        success: function (data) {
          if (data.cameraInitialized) {
            addLogMessage("‚úÖ C√¢mera funcionando corretamente", "text-success");
          } else {
            addLogMessage("‚ùå C√¢mera n√£o inicializada", "text-danger");
          }
        },
        error: function () {
          addLogMessage("‚ùå Erro ao testar c√¢mera", "text-danger");
        },
      });
    }

    function testHandDetection() {
      addLogMessage("ü§ö Testando detec√ß√£o de m√£os...", "text-info");

      $.ajax({
        url: "/api/status",
        method: "GET",
        success: function (data) {
          if (data.handDetected) {
            addLogMessage(
              `‚úÖ M√£o detectada (${
                data.handCount
              } m√£os, confian√ßa: ${Math.round(data.confidence * 100)}%)`,
              "text-success"
            );
          } else {
            addLogMessage("‚ö†Ô∏è Nenhuma m√£o detectada", "text-warning");
          }
        },
        error: function () {
          addLogMessage("‚ùå Erro ao testar detec√ß√£o", "text-danger");
        },
      });
    }

    function testMouse() {
      addLogMessage("üñ±Ô∏è Testando mouse virtual...", "text-info");

      $.ajax({
        url: "/api/status",
        method: "GET",
        success: function (data) {
          if (data.mouseEnabled) {
            addLogMessage("‚úÖ Mouse virtual habilitado", "text-success");
          } else {
            addLogMessage("‚ö†Ô∏è Mouse virtual desabilitado", "text-warning");
          }
        },
        error: function () {
          addLogMessage("‚ùå Erro ao testar mouse", "text-danger");
        },
      });
    }

    function testCalibration() {
      addLogMessage("üéØ Testando calibra√ß√£o...", "text-info");

      $.ajax({
        url: "/api/status",
        method: "GET",
        success: function (data) {
          if (data.calibrated) {
            addLogMessage("‚úÖ Sistema calibrado", "text-success");
          } else {
            addLogMessage(
              "‚ö†Ô∏è Sistema n√£o calibrado - execute a calibra√ß√£o",
              "text-warning"
            );
          }
        },
        error: function () {
          addLogMessage("‚ùå Erro ao testar calibra√ß√£o", "text-danger");
        },
      });
    }

    // Teste autom√°tico ao carregar a p√°gina
    $(document).ready(function () {
      setTimeout(function () {
        addLogMessage("üöÄ Iniciando testes autom√°ticos...", "text-info");
        testCamera();

        setTimeout(function () {
          testHandDetection();
        }, 1000);

        setTimeout(function () {
          testMouse();
        }, 2000);

        setTimeout(function () {
          testCalibration();
        }, 3000);
      }, 1000);
    });
  </script>
</div>
